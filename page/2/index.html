<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="不忘初心，方得始终">
<meta property="og:type" content="website">
<meta property="og:title" content="Zaki">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Zaki">
<meta property="og:description" content="不忘初心，方得始终">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Zaki">
<meta name="twitter:description" content="不忘初心，方得始终">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title> Zaki </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Zaki</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-something">
          <a href="/404.htm" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            美食与你
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/26/Mysql-Inception/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zaki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xtez3.com1.z0.glb.clouddn.com/IMG_0450.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zaki">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/26/Mysql-Inception/" itemprop="url">
                  搭建Mysql Inception
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-26T11:11:05+08:00">
                2016-04-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/04/26/Mysql-Inception/" class="leancloud_visitors" data-flag-title="搭建Mysql Inception">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="搭建Mysql-Inception"><a href="#搭建Mysql-Inception" class="headerlink" title="搭建Mysql Inception"></a>搭建<code>Mysql Inception</code></h1><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>　　<code>Inception</code>是集审核、执行、回滚于一体的一个自动化运维系统，它是根据<code>MySQL</code>代码修改过来的，用它可以很明确的，详细的，准确的审核<code>MySQL</code>的<code>SQL</code>语句，它的工作模式和<code>MySQL</code>完全相同，可以直接使用<code>MySQL</code>客户端来连接，但不需要验证权限，它相对应用程序（上层审核流程系统等）而言，是一个服务器，在连接时需要指定服务器地址及<code>Inception</code>服务器的端口即可，而它相对要审核或执行的语句所对应的线上<code>MySQL</code>服务器来说，是一个客户端，它在内部需要实时的连接数据库服务器来获取所需要的信息，或者直接在在线上执行相应的语句及获取<code>binlog</code>等，<code>Inception</code>就是一个中间性质的服务。</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h4><p><code>bison</code>下载安装：<br><a href="http://ftp.gnu.org/gnu/bison/" target="_blank" rel="external">bison下载地址</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">wget http://ftp.gnu.org/gnu/bison/bison-2.5.1.tar.gz</div><div class="line">tar -zxvf bison-2.5.1.tar.gz</div><div class="line">cd bison-2.5.1</div><div class="line">./configure</div><div class="line">make &amp;&amp; make install</div></pre></td></tr></table></figure></p>
<p>安装<code>cmake</code>、<code>ncurses</code>、<code>openssl</code>、<code>g++</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install cmake ncurses-devel libssl-dev g++</div></pre></td></tr></table></figure>
<h4 id="安装Inception"><a href="#安装Inception" class="headerlink" title="安装Inception"></a>安装<code>Inception</code></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/mysql-inception/inception.git</div><div class="line">cd inception</div><div class="line">./inception_build.sh debug</div></pre></td></tr></table></figure>
<p><strong>Tips:</strong>每次如果出错之后，需要把编译目录删除掉rm -rf debug，重新执行，不然会执行出错。</p>
<h4 id="修改配置文件"><a href="#修改配置文件" class="headerlink" title="修改配置文件"></a>修改配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">vim /etc/inc.cnf</div><div class="line"># 文件内容</div><div class="line">[inception]</div><div class="line">general_log=1</div><div class="line">general_log_file=inception.log</div><div class="line">port=6669</div><div class="line">socket=/自己目录，请自行修改/inc.socket</div><div class="line">character-set-client-handshake=0</div><div class="line">character-set-server=utf8</div><div class="line">inception_remote_system_password=root</div><div class="line">inception_remote_system_user=wzf1</div><div class="line">inception_remote_backup_port=3306</div><div class="line">inception_remote_backup_host=127.0.0.1</div><div class="line">inception_support_charset=utf8mb4</div><div class="line">inception_enable_nullable=0</div><div class="line">inception_check_primary_key=1</div><div class="line">inception_check_column_comment=1</div><div class="line">inception_check_table_comment=1</div><div class="line">inception_osc_min_table_size=1</div><div class="line">inception_osc_bin_dir=/data/temp</div><div class="line">inception_osc_chunk_time=0.1</div><div class="line">inception_enable_blob_type=1</div><div class="line">inception_check_column_default_value=1</div></pre></td></tr></table></figure>
<p><a href="http://mysql-inception.github.io/inception-document/variables/" target="_blank" rel="external">具体参数变量</a></p>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># 做一个软连接</div><div class="line">ln -s /zxh/software/inception/debug/sql/Inception /usr/bin/Inception</div><div class="line"># 启动</div><div class="line">Inception --defaults-file=/etc/inc.cnf</div></pre></td></tr></table></figure>
<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>启动如果不报错的话，说明已经启动成功了，实际上很难让它报错，因为非常轻量级</p>
<p>启动成功之后，可以简单试一下看，通过MySQL客户端 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -uroot -h127.0.0.1 -P6669</div></pre></td></tr></table></figure>
<p>登录上去之后，再执行一个命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">inception get variables;</div></pre></td></tr></table></figure>
<p>输出了所有的变量，恭喜你，已经启动成功了，都说了非常简单。</p>
<h3 id="web界面安装"><a href="#web界面安装" class="headerlink" title="web界面安装"></a>web界面安装</h3><h4 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python2.7 + flask</div></pre></td></tr></table></figure>
<h4 id="安装依赖模块"><a href="#安装依赖模块" class="headerlink" title="安装依赖模块"></a>安装依赖模块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pip install flask_wtf</div><div class="line">pip install flask-script</div><div class="line">pip install flask-debugtoolbar</div><div class="line">pip install MySQL-python</div></pre></td></tr></table></figure>
<h4 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 取回源码</div><div class="line">git clone https://github.com/dbalihui/inception_web</div></pre></td></tr></table></figure>
<p>先将app目录中的<code>inception.py</code>文件里的账号密码改成自己的,记得<code>use sql_check</code>这里要改成自己的数据库名字。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 在inception_web目录下运行</div><div class="line">./run.py runserver --host 0.0.0.0</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 使用浏览器访问你的IP</div><div class="line"> http://192.168.xx.xxx:5000/</div></pre></td></tr></table></figure>
<p>效果图：<br><img src="/images/1461640582748.png" alt="Alt text"></p>
<p><strong>(Tips:运行报错的话是因为没有安装flask组件，请使用pip install xx安装相关组件)</strong></p>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="http://mysql-inception.github.io/inception-document/chapter1/" target="_blank" rel="external">Mysql-Inception官方文档</a><br><a href="https://github.com/dbalihui/inception_web" target="_blank" rel="external">Inception-web源码和文档</a><br><a href="http://blog.tanchao.org/2016/01/05/mysql-inception-web/" target="_blank" rel="external">OutMan‘s blog</a><br><a href="https://github.com/mysql-inception/inception" target="_blank" rel="external">Mysql-Inception源码</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/24/Mysql-Performance-Test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zaki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xtez3.com1.z0.glb.clouddn.com/IMG_0450.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zaki">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/24/Mysql-Performance-Test/" itemprop="url">
                  Mysql基础性能测试
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-24T18:11:05+08:00">
                2016-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/04/24/Mysql-Performance-Test/" class="leancloud_visitors" data-flag-title="Mysql基础性能测试">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>　　以下测试是由<code>Mysql</code>数据库的初学者进行了一系列操作测试，可能会有很多数据上的误差，请各位<code>Mysql</code>大牛看见了勿喷，有哪些错误的地方可以帮我指出，我可以进行改正。</p>
<h3 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h3><p>　　使用脚本<code>bigtab-in.sh</code>插入数据，生成小表和大表。<br><strong>主数据库</strong><br><strong>QPS：</strong><br><img src="/images/1461207519678.png" alt="Alt text"><br><strong>TPS：</strong><br><img src="/images/1461207696634.png" alt="Alt text"></p>
<p><strong>CPU load：</strong><br><img src="/images/1461207624009.png" alt="Alt text"><br><strong>IO wait</strong><br><img src="/images/1461207714894.png" alt="Alt text"></p>
<p><strong>从数据库</strong><br><strong>QPS：</strong><br><img src="/images/1461207760151.png" alt="Alt text"><br><strong>TPS：</strong><br><img src="/images/1461207480796.png" alt="Alt text"><br><strong>CPU load：</strong><br><img src="/images/1461207783675.png" alt="Alt text"><br><strong>IO wait</strong><br><img src="/images/1461207795402.png" alt="Alt text"><br><strong>Seconds_Behind_Master</strong><br><img src="/images/1461208160742.png" alt="Alt text"></p>
<p><strong>具体描述：</strong><br>从<code>10:18</code>分进行数据插入，<code>10:56</code>数据插入结束，创建了一个大表<code>(test_table_b)</code>一个小表<code>（test_table_a）</code>，小表通过一句一句的随机插入创建，大表通过复制小表创建，中途<code>（10:42-10:45）</code>的时候出现创建大表脚本错误，找到问题，重新执行了一下。<br><strong>发现问题：</strong><br><strong>1、</strong>主数据库没有<code>TPS</code>，从数据库没有<code>QPS</code>（怀疑：因为是主数据库做插入数据，所以属于<code>Queries</code>操作；而从数据库是使用<code>slave</code>进行同步，所以属于事务操作。）<br><strong>2、</strong><code>Seconds_Behind_Master</code>一直是<code>0</code>？（看了脚本执行，最开始确实有错，修改了之后也能出来具体的数值，但是在<code>zabbix</code>上面监控的数据就是<code>0</code>，怀疑是<code>zabbix</code>的配置问题）<br><strong>3、</strong>为什么<code>QPS</code>一直是<code>1</code>？(发现因为每次<code>zabbix</code>调用脚本去<code>show</code>出<code>queries</code>的时候都要加<code>3</code>)</p>
<h3 id="进行测试"><a href="#进行测试" class="headerlink" title="进行测试"></a>进行测试</h3><h4 id="1、添加索引（一句添加一个）"><a href="#1、添加索引（一句添加一个）" class="headerlink" title="1、添加索引（一句添加一个）"></a><strong>1、添加索引（一句添加一个）</strong></h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ALTER TABLE `test_table_b` ADD INDEX(createtime);</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (5 min 19.05 sec)         </div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>iowait：<br><img src="/images/1461219108244.png" alt="Alt text"><br>大概7分钟左右。</p>
<h4 id="2、添加索引（多句修改多个）"><a href="#2、添加索引（多句修改多个）" class="headerlink" title="2、添加索引（多句修改多个）"></a>2、添加索引（多句修改多个）</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ALTER TABLE `test_table_b` ADD INDEX(createtime);</div><div class="line">ALTER TABLE `test_table_b` ADD INDEX(name);</div><div class="line">ALTER TABLE `test_table_b` ADD INDEX(age);</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (5 min 17.07 sec)         </div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 0 rows affected (5 min 51.08 sec)         </div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 0 rows affected (5 min 39.38 sec)         </div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>iowait：<br><img src="/images/1461222070278.png" alt="Alt text"><br>大概19分钟左右。</p>
<h4 id="3、添加索引（一句修改多个）"><a href="#3、添加索引（一句修改多个）" class="headerlink" title="3、添加索引（一句修改多个）"></a>3、添加索引（一句修改多个）</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ALTER TABLE `test_table_b` ADD INDEX(createtime),ADD INDEX(name),ADD INDEX(age);</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (7 min 55.30 sec)         </div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>iowait：<br><img src="/images/1461220178411.png" alt="Alt text"></p>
<h4 id="4、添加索引（OSC变更）"><a href="#4、添加索引（OSC变更）" class="headerlink" title="4、添加索引（OSC变更）"></a>4、添加索引（OSC变更）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">pt-online-schema-change --user=root --password=warren --host=127.0.0.1  --alter &quot;ADD INDEX idx_name(name)&quot; D=test_20160421,t=test_table_b --no-check-alter --no-check-replication-filters --recursion-method=none --print --execute</div><div class="line"># 测试结果</div><div class="line">2016-04-21T15:01:55 Created triggers OK.</div><div class="line">2016-04-21T15:01:55 Copying approximately 5839363 rows...</div><div class="line">2016-04-21T16:07:28 Copied rows OK.</div><div class="line">2016-04-21T16:07:28 Analyzing new table...</div><div class="line">2016-04-21T16:07:33 Swapping tables...</div><div class="line">RENAME TABLE `test_20160421`.`test_table_b` TO `test_20160421`.`_test_table_b_old`, `test_20160421`.`_test_table_b_new` TO `test_20160421`.`test_table_b`</div><div class="line">2016-04-21T16:07:37 Swapped original and new tables OK.</div><div class="line">2016-04-21T16:07:37 Dropping old table...</div><div class="line">DROP TABLE IF EXISTS `test_20160421`.`_test_table_b_old`</div><div class="line">2016-04-21T16:07:40 Dropped old table `test_20160421`.`_test_table_b_old` OK.</div><div class="line">2016-04-21T16:07:40 Dropping triggers...</div></pre></td></tr></table></figure>
<p>大约用时：1小时6分钟<br><strong>从库：</strong><br>TPS:<br><img src="/images/1461226653253.png" alt="Alt text"><br>大约用时：1小时6分钟</p>
<h4 id="5、删除索引（一句添加一个）"><a href="#5、删除索引（一句添加一个）" class="headerlink" title="5、删除索引（一句添加一个）"></a>5、删除索引（一句添加一个）</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">DROP INDEX createtime ON test_table_b;</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (0.10 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>iowait：</p>
<p>大约0.1秒</p>
<h4 id="6、删除索引（多句修改多个）"><a href="#6、删除索引（多句修改多个）" class="headerlink" title="6、删除索引（多句修改多个）"></a>6、删除索引（多句修改多个）</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">ALTER TABLE `test_table_b` DROP INDEX createtime;</div><div class="line">ALTER TABLE `test_table_b` DROP INDEX name;</div><div class="line">ALTER TABLE `test_table_b` DROP INDEX age;</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (0.69 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 0 rows affected (3.00 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 0 rows affected (0.12 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>大约3.81秒</p>
<h4 id="7、删除索引（一句修改多个）"><a href="#7、删除索引（一句修改多个）" class="headerlink" title="7、删除索引（一句修改多个）"></a>7、删除索引（一句修改多个）</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ALTER TABLE `test_table_b` DROP INDEX createtime,DROP INDEX name,DROP INDEX age;</div><div class="line"># 测试结果</div><div class="line">Query OK, 0 rows affected (0.31 sec)</div><div class="line">Records: 0  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>大约0.31秒</p>
<h4 id="8、删除索引（OSC变更）"><a href="#8、删除索引（OSC变更）" class="headerlink" title="8、删除索引（OSC变更）"></a>8、删除索引（OSC变更）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">pt-online-schema-change --user=root --password=warren --host=127.0.0.1 --alter &quot;DROP INDEX idx_name&quot; D=test_20160421,t=test_table_b --no-check-alter --no-check-replication-filters --recursion-method=none --print --execute</div><div class="line"># 测试结果</div><div class="line">2016-04-21T20:06:15 Creating triggers...</div><div class="line">2016-04-21T20:17:42 Dropped triggers OK.</div><div class="line">2016-04-21T20:17:42 Dropping new table...</div></pre></td></tr></table></figure>
<p>使用时间：11分钟27秒=687秒<br><strong>从库：</strong><br>无法取得准确数据</p>
<h4 id="9、update大量数据-用主键"><a href="#9、update大量数据-用主键" class="headerlink" title="9、update大量数据(用主键)"></a>9、update大量数据(用主键)</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 查询数据条数</div><div class="line">select count(*) from test_table_b where id&gt;2000 and id&lt;3000000; </div><div class="line">+----------+</div><div class="line">| count(*) |</div><div class="line">+----------+</div><div class="line">|  1836202 |</div><div class="line">+----------+</div><div class="line">1 row in set (26.55 sec)</div><div class="line"></div><div class="line"># 更新数据</div><div class="line">update test_table_b set age=50 where id&gt;2000 and id&lt;3000000; </div><div class="line"># 测试结果</div><div class="line">Query OK, 1836202 rows affected (3 min 45.09 sec)</div><div class="line">Rows matched: 1836202  Changed: 1836202  Warnings: 0</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>无法取得准确数据</p>
<h4 id="10、update大量数据-非主键-非索引"><a href="#10、update大量数据-非主键-非索引" class="headerlink" title="10、update大量数据(非主键 非索引)"></a>10、update大量数据(非主键 非索引)</h4><p><strong>主库：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 查询数据条数</div><div class="line">select count(*) from test_table_b where createtime&lt;&quot;2016-04-21 10:35:23&quot; and createtime&gt;&quot;2016-04-21 10:20:23&quot;; </div><div class="line">+----------+</div><div class="line">| count(*) |</div><div class="line">+----------+</div><div class="line">|  4080752 |</div><div class="line">+----------+</div><div class="line">1 row in set (4 min 27.36 sec)</div><div class="line"></div><div class="line"># 更新数据</div><div class="line">update test_table_b set age=30 where createtime&lt;&quot;2016-04-21 10:35:23&quot; and createtime&gt;&quot;2016-04-21 10:20:23&quot;; </div><div class="line"># 测试结果</div><div class="line">Query OK, 4080752 rows affected (5 min 38.14 sec)</div><div class="line">Rows matched: 4080752  Changed: 4080752  Warnings: 0</div></pre></td></tr></table></figure></p>
<p><strong>从库：</strong><br>iowait:<br><img src="/images/1461227721260.png" alt="Alt text"><br>大约7分钟</p>
<h4 id="11、update大量数据-非主键-有索引"><a href="#11、update大量数据-非主键-有索引" class="headerlink" title="11、update大量数据(非主键 有索引)"></a>11、update大量数据(非主键 有索引)</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 查询数据条数</div><div class="line">select count(*) from test_table_b where name&lt;&quot;用户20000&quot; and createtime&gt;&quot;用户2000&quot;; </div><div class="line">+----------+</div><div class="line">| count(*) |</div><div class="line">+----------+</div><div class="line">|  2029612 |</div><div class="line">+----------+</div><div class="line">1 row in set, 1 warning (1 min 45.53 sec)</div><div class="line"></div><div class="line"># 更新数据</div><div class="line">update test_table_b set age=40 where name&lt;&quot;用户20000&quot; and createtime&gt;&quot;用户2000&quot;;</div><div class="line"># 测试结果</div><div class="line">Query OK, 2029612 rows affected, 1 warning (6 min 27.09 sec)</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>iowait：<br>无法取得准确数据</p>
<h4 id="12、连表查询"><a href="#12、连表查询" class="headerlink" title="12、连表查询"></a>12、连表查询</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">select * from test_table_b left join test_table_a on test_table_b.id=test_table_a.id where test_table_b.id &lt; 50000;</div><div class="line"># 测试结果</div><div class="line">37232 rows in set (1.02 sec)</div></pre></td></tr></table></figure>
<h4 id="13、排序查询"><a href="#13、排序查询" class="headerlink" title="13、排序查询"></a>13、排序查询</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">select * from test_table_b where id &lt; 2000000 order by createtime DESC;</div><div class="line"># 测试结果</div></pre></td></tr></table></figure>
<h4 id="14、修改表结构（一句修改一个）"><a href="#14、修改表结构（一句修改一个）" class="headerlink" title="14、修改表结构（一句修改一个）"></a>14、修改表结构（一句修改一个）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">alter table test_table_b modify name varchar(70);</div><div class="line"># 测试结果</div><div class="line">Query OK, 5980000 rows affected (22 min 51.15 sec)     </div><div class="line">Records: 5980000  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>IOwait:<br><img src="/images/1461234760212.png" alt="Alt text"></p>
<h4 id="15、修改表结构（多句修改多个）"><a href="#15、修改表结构（多句修改多个）" class="headerlink" title="15、修改表结构（多句修改多个）"></a>15、修改表结构（多句修改多个）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">alter table test_table_b modify name varchar(30);</div><div class="line">alter table test_table_b drop column test;</div><div class="line">alter table test_table_b add test2 int(20);</div><div class="line"># 测试结果&amp;</div><div class="line">Query OK, 6360000 rows affected (39 min 43.42 sec)     </div><div class="line">Records: 6360000  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 6360000 rows affected (36 min 36.42 sec)     </div><div class="line">Records: 6360000  Duplicates: 0  Warnings: 0</div><div class="line">Query OK, 6360000 rows affected (37 min 21.26 sec)     </div><div class="line">Records: 6360000  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>无法取得准确数据</p>
<h4 id="16、修改表结构（一句修改多个）"><a href="#16、修改表结构（一句修改多个）" class="headerlink" title="16、修改表结构（一句修改多个）"></a>16、修改表结构（一句修改多个）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">alter table test_table_b modify name varchar(50),add test int(20),modify age int(20);</div><div class="line"># 测试数据</div><div class="line">Query OK, 6020000 rows affected (43 min 27.49 sec)     </div><div class="line">Records: 6020000  Duplicates: 0  Warnings: 0</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br><img src="/images/1461239357277.png" alt="Alt text"></p>
<h4 id="17、修改表结构（OSC变更）"><a href="#17、修改表结构（OSC变更）" class="headerlink" title="17、修改表结构（OSC变更）"></a>17、修改表结构（OSC变更）</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pt-online-schema-change --user=root --password=warren --host=127.0.0.1  --alter &quot;CHANGE COLUMN age AGE int(30)&quot; D=test_20160421,t=test_table_b --no-check-alter --no-check-replication-filters --recursion-method=none --quiet --execut</div><div class="line"></div><div class="line"># 测试结果</div><div class="line">出现异常报错</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>无法获取数据</p>
<h4 id="18、detele大量数据-用主键"><a href="#18、detele大量数据-用主键" class="headerlink" title="18、detele大量数据(用主键)"></a>18、detele大量数据(用主键)</h4><p><strong>主库：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">delete from test_table_a where id &lt; 3054793</div></pre></td></tr></table></figure>
<p><strong>从库：</strong><br>无法获取数据</p>
<h3 id="数据汇总"><a href="#数据汇总" class="headerlink" title="数据汇总"></a>数据汇总</h3><p>（以下数据可能存在很多错误）<br><strong>主库测试数据：</strong><br><img src="/images/1461242852929.png" alt="Alt text"><br><strong>从库测试数据：</strong><br>（由于能力的问题，不能很好的取到Slave同步所用的时间）<br><img src="/images/1461242906692.png" alt="Alt text"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过本次<code>mysql</code>的性能测试，学习到的以下的东西：<br><strong>1）</strong>在进行<code>insert、update、delete、select</code>操作的时候会影响<code>Mysql</code>的<code>QPS</code>。<br><strong>2）</strong><code>slave</code>同步<code>master</code>的时候，会影响<code>Mysql</code>的<code>TPS</code>。<br><strong>3）</strong>在进行添加删除索引和字段的时候会锁表，只能查询<code>Mysql</code>，不能写入<code>Mysql</code>。<br><strong>4）</strong><code>master</code>进行删除添加索引和字段完成后，<code>slave</code>才会去同步，两者是异步进行的，而且<code>slave</code>同步过程中还会造成<code>Seconds_Behind_Master</code>值变得很高（这里有个问题，通过<code>zabbix</code>监控的<code>Seconds_Behind_Master</code>值会在一瞬间就降到零）<br><strong>5）</strong>使用<code>percona</code>的<code>OSC</code>变更工具进行添加删除索引和字段的时候，不会锁表，可以边变更边插入数据。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/08/PXC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zaki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xtez3.com1.z0.glb.clouddn.com/IMG_0450.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zaki">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/08/PXC/" itemprop="url">
                  PXC集群搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-08T14:11:05+08:00">
                2016-04-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/04/08/PXC/" class="leancloud_visitors" data-flag-title="PXC集群搭建">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="环境情况："><a href="#环境情况：" class="headerlink" title="环境情况："></a>环境情况：</h3><p>OS: centos release 6.6</p>
<table>
<thead>
<tr>
<th style="text-align:center">server</th>
<th style="text-align:center">Hostname</th>
<th style="text-align:center">ip</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node1</td>
<td style="text-align:center">192.168.42.135</td>
</tr>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node2</td>
<td style="text-align:center">192.168.42.136</td>
</tr>
<tr>
<td style="text-align:center">PXC</td>
<td style="text-align:center">node3</td>
<td style="text-align:center">192.168.42.137</td>
</tr>
</tbody>
</table>
<h3 id="一、PXC的优缺点"><a href="#一、PXC的优缺点" class="headerlink" title="一、PXC的优缺点"></a>一、PXC的优缺点</h3><h4 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h4><p><strong>①.</strong>数据同步复制(并发复制)，几乎无延迟；<br><strong>②.</strong>多个可同时读写节点，可实现写扩展，不过最好事先进行分库分表，让各个节点分别写不同的表或者库，避免让galera解决数据冲突；<br><strong>③.</strong>新节点可以自动部署，部署操作简单；<br><strong>④.</strong>数据严格一致性，尤其适合电商类应用；<br><strong>⑤.</strong>完全兼容MySQL；<br><strong>⑥.</strong>虽然有这么多好处，但也有些局限性：<br><strong>⑦.</strong>服务高可用；</p>
<h4 id="缺陷："><a href="#缺陷：" class="headerlink" title="缺陷："></a>缺陷：</h4><p><strong>①.</strong>只支持InnoDB引擎；<br><strong>②.</strong>所有表都要有主键；<br><strong>③.</strong>不支持LOCK TABLE等显式锁操作；<br><strong>④.</strong>锁冲突、死锁问题相对更多；<br><strong>⑤.</strong>不支持XA；<br><strong>⑥.</strong>集群吞吐量/性能取决于短板；<br><strong>⑦.</strong>新加入节点采用SST时代价高；<br><strong>⑧.</strong>存在写扩大问题；<br><strong>⑨.</strong>如果并发事务量很大的话，建议采用InfiniBand网络，降低网络延迟；</p>
<p><strong>事实上，采用PXC的主要目的是解决数据的一致性问题，高可用是顺带实现的。因为PXC存在写扩大以及短板效应，并发效率会有较大损失，类似semi sync replication机制。</strong></p>
<h3 id="二、PXC和M-S（主从同步）的对比"><a href="#二、PXC和M-S（主从同步）的对比" class="headerlink" title="二、PXC和M/S（主从同步）的对比"></a>二、PXC和M/S（主从同步）的对比</h3><table>
<thead>
<tr>
<th style="text-align:center">\</th>
<th style="text-align:center">PXC</th>
<th style="text-align:center">M/S</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">数据同步复制，无延迟</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">数据异步复制</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">一致性（所有节点的数据一致）</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">可用性（一个或多个节点失效，不影响服务请求。）</td>
<td style="text-align:center">√</td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">分区容忍性（节点间的连接失效，仍然可以处理请求。）</td>
<td style="text-align:center"></td>
<td style="text-align:center">√</td>
</tr>
<tr>
<td style="text-align:center">执行查询查询本地</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">多个库的同时读写</td>
<td style="text-align:center">√</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">支持的存储引擎</td>
<td style="text-align:center">innodb</td>
<td style="text-align:center">ALL</td>
</tr>
<tr>
<td style="text-align:center">表结构</td>
<td style="text-align:center">特殊</td>
<td style="text-align:center">一般</td>
</tr>
<tr>
<td style="text-align:center">锁冲突、死锁问题</td>
<td style="text-align:center">较多</td>
<td style="text-align:center">较少</td>
</tr>
<tr>
<td style="text-align:center">是否支持XA</td>
<td style="text-align:center">NO</td>
<td style="text-align:center">YES</td>
</tr>
<tr>
<td style="text-align:center">新加入节点</td>
<td style="text-align:center">代价较大</td>
<td style="text-align:center">相对简单</td>
</tr>
<tr>
<td style="text-align:center">脑裂</td>
<td style="text-align:center">可以防止</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">处理并发大事务</td>
<td style="text-align:center">不能</td>
<td style="text-align:center">能</td>
</tr>
</tbody>
</table>
<h3 id="三、PXC集群搭建"><a href="#三、PXC集群搭建" class="headerlink" title="三、PXC集群搭建"></a>三、PXC集群搭建</h3><h4 id="1、关闭集群的防火墙和selinux"><a href="#1、关闭集群的防火墙和selinux" class="headerlink" title="1、关闭集群的防火墙和selinux"></a>1、关闭集群的防火墙和selinux</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#即时关闭防火墙</div><div class="line">service iptables stop</div><div class="line">#永久关闭防火墙</div><div class="line">chkconfig iptables off</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#永久禁用，需要重启生效。</div><div class="line">sed -i &apos;s/SELINUX=enforcing/SELINUX=disabled/g&apos; /etc/selinux/config  </div><div class="line">#临时禁用，不需要重启</div><div class="line">setenforce 0</div></pre></td></tr></table></figure>
<h4 id="2、修改主机名"><a href="#2、修改主机名" class="headerlink" title="2、修改主机名"></a>2、修改主机名</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#在每个节点上的hosts里面加入</div><div class="line">vim /etc/hosts</div><div class="line">192.168.42.135 node1</div><div class="line">192.168.42.136 node2</div><div class="line">192.168.42.137 node3</div><div class="line">#修改为本机应该的节点名</div><div class="line">vim /etc/sysconfig/network</div><div class="line">hostname=node（1、2、3）</div><div class="line">#重启网络服务</div><div class="line">service network restart</div><div class="line">#查看主机名和主机名对应的IP</div><div class="line">hostname</div><div class="line">hostname -i</div></pre></td></tr></table></figure>
<h4 id="3、实现3个节点之间的无密码登录"><a href="#3、实现3个节点之间的无密码登录" class="headerlink" title="3、实现3个节点之间的无密码登录"></a>3、实现3个节点之间的无密码登录</h4><p>1）在所有节点上执行：<br><code>ssh-keygen -t rsa</code><br> 2）将所有机子上公钥（<code>id_rsa.pub</code>）导到一个主机的<code>/root/.ssh/authorized_keys</code>文件中,然后将<code>authorized_keys</code>分别拷贝到所有主机上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#在192.168.42.137上操作</div><div class="line">cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</div><div class="line">#将192.168.42.136上的公钥拷到137本地</div><div class="line">ssh root@192.168.42.135  cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</div><div class="line">#将192.168.42.135上的公钥拷到137本地</div><div class="line">ssh root@192.168.42.136  cat /root/.ssh/id_rsa.pub &gt;&gt; /root/.ssh/authorized_keys</div><div class="line">#拷贝到135服务器上</div><div class="line">scp /root/.ssh/authorized_keys root@192.168.42.135:/root/.ssh/authorized_keys</div><div class="line">#拷贝到136服务器上</div><div class="line">scp /root/.ssh/authorized_keys root@192.168.42.136:/root/.ssh/authorized_keys</div><div class="line">#测试是否免密登录</div><div class="line">ssh 192.168.42.136</div><div class="line">ssh 192.168.42.135</div></pre></td></tr></table></figure>
<p>··············································································<br>（更新后的方法，使用<code>ssh-copy-id</code>远程传公钥）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#创建公钥</div><div class="line">ssh-keygen -t rsa</div><div class="line">#把公钥追加到其他需要免密登录的服务器</div><div class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.135</div><div class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.136</div><div class="line">ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.137</div><div class="line">#测试免密登录</div><div class="line">[root@node1 .ssh]# ssh 192.168.42.137</div><div class="line">Last login: Tue Mar 22 23:29:55 2016 from 192.168.42.1</div><div class="line">[root@node3 ~]#</div></pre></td></tr></table></figure>
<h4 id="4、安装percona环境"><a href="#4、安装percona环境" class="headerlink" title="4、安装percona环境"></a>4、安装percona环境</h4><h5 id="1）配置yum源："><a href="#1）配置yum源：" class="headerlink" title="1）配置yum源："></a>1）配置yum源：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum -y install http://www.percona.com/downloads/percona-release/redhat/0.1-3/percona-release-0.1-3.noarch.rpm</div><div class="line">yum -y install epel*</div></pre></td></tr></table></figure>
<h5 id="2）安装Percona软件："><a href="#2）安装Percona软件：" class="headerlink" title="2）安装Percona软件："></a>2）安装Percona软件：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install Percona-XtraDB-Cluster-server Percona-XtraDB-Cluster-client Percona-Server-shared-compat percona-xtrabackup</div></pre></td></tr></table></figure>
<h5 id="3）添加账号"><a href="#3）添加账号" class="headerlink" title="3）添加账号"></a>3）添加账号</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/mysql bootstrap-pxc     //启动PXC</div><div class="line">mysql</div><div class="line">----------------------------------------&gt;</div><div class="line">grant all privileges on *.* to &apos;sst&apos;@localhost identified by &apos;123456&apos;;</div><div class="line">FLUSH PRIVILEGES;</div><div class="line">&lt;----------------------------------------</div><div class="line">/etc/init.d/mysql stop</div></pre></td></tr></table></figure>
<h4 id="5、PXC的节点配置"><a href="#5、PXC的节点配置" class="headerlink" title="5、PXC的节点配置"></a>5、PXC的节点配置</h4><h5 id="1）135："><a href="#1）135：" class="headerlink" title="1）135："></a>1）135：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">serv-id = 1</div><div class="line"># Percona XtraDB Cluster</div><div class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</div><div class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</div><div class="line">wsrep_sst_auth=sst:123456</div><div class="line">wsrep_cluster_name=Percona</div><div class="line">wsrep_sst_method=xtrabackup-v2</div><div class="line">wsrep_node_address=192.168.42.135</div><div class="line">wsrep_slave_threads=2</div><div class="line">innodb_locks_unsafe_for_binlog=1</div><div class="line">innodb_autoinc_lock_mode=2</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#启动第一个节点</div><div class="line">/etc/init.d/mysql bootstrap-pxc</div></pre></td></tr></table></figure>
<h5 id="2）136"><a href="#2）136" class="headerlink" title="2）136"></a>2）136</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">serv-id = 2</div><div class="line"># Percona XtraDB Cluster</div><div class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</div><div class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</div><div class="line">wsrep_sst_auth=sst:123456</div><div class="line">wsrep_cluster_name=Percona</div><div class="line">wsrep_sst_method=xtrabackup-v2</div><div class="line">wsrep_node_address=192.168.42.136</div><div class="line">wsrep_slave_threads=2</div><div class="line">innodb_locks_unsafe_for_binlog=1</div><div class="line">innodb_autoinc_lock_mode=2</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#启动第二个节点</div><div class="line">/etc/init.d/mysql start</div></pre></td></tr></table></figure>
<h5 id="3）137"><a href="#3）137" class="headerlink" title="3）137"></a>3）137</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">serv-id = 3</div><div class="line"># Percona XtraDB Cluster</div><div class="line">wsrep_provider=/usr/lib64/libgalera_smm.so</div><div class="line">wsrep_cluster_address=&quot;gcomm://192.168.42.135,192.168.42.136,192.168.42.137&quot;</div><div class="line">wsrep_sst_auth=sst:123456</div><div class="line">wsrep_cluster_name=Percona</div><div class="line">wsrep_sst_method=xtrabackup-v2</div><div class="line">wsrep_node_address=192.168.42.137</div><div class="line">wsrep_slave_threads=2</div><div class="line">innodb_locks_unsafe_for_binlog=1</div><div class="line">innodb_autoinc_lock_mode=2</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#启动第三个节点</div><div class="line">/etc/init.d/mysql start</div></pre></td></tr></table></figure>
<h5 id="4）随便进一个节点查看集群状态"><a href="#4）随便进一个节点查看集群状态" class="headerlink" title="4）随便进一个节点查看集群状态"></a>4）随便进一个节点查看集群状态</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SHOW STATUS LIKE &apos;%wsrep%&apos;;</div><div class="line">+------------------------------+-------------------------------------------------------------+</div><div class="line">| Variable_name                | Value                                                       |</div><div class="line">+------------------------------+-------------------------------------------------------------+</div><div class="line">| wsrep_local_state_uuid       | 54ebc9fd-f57f-11e5-baaa-96a1ced0928f                        |</div><div class="line">| wsrep_protocol_version       | 7                                                           |</div><div class="line">| wsrep_last_committed         | 0                                                           |</div><div class="line">| wsrep_replicated             | 0                                                           |</div><div class="line">| wsrep_replicated_bytes       | 0                                                           |</div><div class="line">| wsrep_repl_keys              | 0                                                           |</div><div class="line">| wsrep_repl_keys_bytes        | 0                                                           |</div><div class="line">| wsrep_repl_data_bytes        | 0                                                           |</div><div class="line">| wsrep_repl_other_bytes       | 0                                                           |</div><div class="line">| wsrep_received               | 10                                                          |</div><div class="line">| wsrep_received_bytes         | 784                                                         |</div><div class="line">| wsrep_local_commits          | 0                                                           |</div><div class="line">| wsrep_local_cert_failures    | 0                                                           |</div><div class="line">| wsrep_local_replays          | 0                                                           |</div><div class="line">| wsrep_local_send_queue       | 0                                                           |</div><div class="line">| wsrep_local_send_queue_max   | 1                                                           |</div><div class="line">| wsrep_local_send_queue_min   | 0                                                           |</div><div class="line">| wsrep_local_send_queue_avg   | 0.000000                                                    |</div><div class="line">| wsrep_local_recv_queue       | 0                                                           |</div><div class="line">| wsrep_local_recv_queue_max   | 1                                                           |</div><div class="line">| wsrep_local_recv_queue_min   | 0                                                           |</div><div class="line">| wsrep_local_recv_queue_avg   | 0.000000                                                    |</div><div class="line">| wsrep_local_cached_downto    | 0                                                           |</div><div class="line">| wsrep_flow_control_paused_ns | 0                                                           |</div><div class="line">| wsrep_flow_control_paused    | 0.000000                                                    |</div><div class="line">| wsrep_flow_control_sent      | 0                                                           |</div><div class="line">| wsrep_flow_control_recv      | 0                                                           |</div><div class="line">| wsrep_cert_deps_distance     | 0.000000                                                    |</div><div class="line">| wsrep_apply_oooe             | 0.000000                                                    |</div><div class="line">| wsrep_apply_oool             | 0.000000                                                    |</div><div class="line">| wsrep_apply_window           | 0.000000                                                    |</div><div class="line">| wsrep_commit_oooe            | 0.000000                                                    |</div><div class="line">| wsrep_commit_oool            | 0.000000                                                    |</div><div class="line">| wsrep_commit_window          | 0.000000                                                    |</div><div class="line">| wsrep_local_state            | 4                                                           |</div><div class="line">| wsrep_local_state_comment    | Synced                                                      |</div><div class="line">| wsrep_cert_index_size        | 0                                                           |</div><div class="line">| wsrep_cert_bucket_count      | 22                                                          |</div><div class="line">| wsrep_gcache_pool_size       | 1580                                                        |</div><div class="line">| wsrep_causal_reads           | 0                                                           |</div><div class="line">| wsrep_cert_interval          | 0.000000                                                    |</div><div class="line">| wsrep_incoming_addresses     | 192.168.42.135:3306,192.168.42.137:3306,192.168.42.136:3306 |</div><div class="line">| wsrep_evs_delayed            |                                                             |</div><div class="line">| wsrep_evs_evict_list         |                                                             |</div><div class="line">| wsrep_evs_repl_latency       | 0.00090448/0.00124879/0.00183671/0.000306234/6              |</div><div class="line">| wsrep_evs_state              | OPERATIONAL                                                 |</div><div class="line">| wsrep_gcomm_uuid             | 54e770a4-f57f-11e5-a4eb-1ae05e4a0e6e                        |</div><div class="line">| wsrep_cluster_conf_id        | 3                                                           |</div><div class="line">| wsrep_cluster_size           | 3                                                           |</div><div class="line">| wsrep_cluster_state_uuid     | 54ebc9fd-f57f-11e5-baaa-96a1ced0928f                        |</div><div class="line">| wsrep_cluster_status         | Primary                                                     |</div><div class="line">| wsrep_connected              | ON                                                          |</div><div class="line">| wsrep_local_bf_aborts        | 0                                                           |</div><div class="line">| wsrep_local_index            | 0                                                           |</div><div class="line">| wsrep_provider_name          | Galera                                                      |</div><div class="line">| wsrep_provider_vendor        | Codership Oy &lt;info@codership.com&gt;                           |</div><div class="line">| wsrep_provider_version       | 3.14(r53b88eb)                                              |</div><div class="line">| wsrep_ready                  | ON                                                          |</div><div class="line">| wsrep_thread_count           | 3                                                           |</div><div class="line">+------------------------------+-------------------------------------------------------------+</div><div class="line">59 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p><strong>这里PXC集群搭建完毕，可以在每个节点上进行读写，而且每个节点数据保证完整一致。</strong></p>
<h3 id="四、PXC集群测试"><a href="#四、PXC集群测试" class="headerlink" title="四、PXC集群测试"></a>四、PXC集群测试</h3><h4 id="1、基础测试"><a href="#1、基础测试" class="headerlink" title="1、基础测试"></a>1、基础测试</h4><h5 id="1）在135上："><a href="#1）在135上：" class="headerlink" title="1）在135上："></a>1）在135上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">create database test_pxc;</div><div class="line">use test_pxc;</div><div class="line">create table test_pxc (id int,name char(10)) engine=innodb;</div><div class="line">commit;</div></pre></td></tr></table></figure>
<h5 id="2）在136上："><a href="#2）在136上：" class="headerlink" title="2）在136上："></a>2）在136上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">use test_pxc</div><div class="line">insert into test_pxc values(1,&apos;test&apos;);</div><div class="line">commit;</div></pre></td></tr></table></figure>
<h5 id="3）在137上："><a href="#3）在137上：" class="headerlink" title="3）在137上："></a>3）在137上：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">use test_pxc;</div><div class="line">select * from test_pxc;</div><div class="line">+------+------+</div><div class="line">| id   | name |</div><div class="line">+------+------+</div><div class="line">|    1 | test |</div><div class="line">+------+------+</div></pre></td></tr></table></figure>
<h4 id="2、并发测试"><a href="#2、并发测试" class="headerlink" title="2、并发测试"></a>2、并发测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#创建一个测试表</div><div class="line">create table t2(id int(11),name varchar(20),time timestamp) engine=innodb;</div><div class="line">#写插入数据脚本</div><div class="line">vim in.sh</div><div class="line">#脚本内容</div><div class="line"># 插入大量测试数据</div><div class="line">#!/bin/bash</div><div class="line">for (( a=1 ; a&lt;=1000 ; a++  ))</div><div class="line">do</div><div class="line">            name=&quot;db6.$a&quot;</div><div class="line">                    mysql -e &quot;insert into test_pxc.t2 (name, time) values (\&quot;$name\&quot;, now())&quot;</div><div class="line">                done</div><div class="line">#将这个脚本拷贝到每个服务器上</div><div class="line">scp in.sh root@192.168.42.136:/zxh/scripts/</div><div class="line">scp in.sh root@192.168.42.137:/zxh/scripts/</div><div class="line">#3个节点同时执行插入数据（并发执行）</div><div class="line">#其中一个节点的一条数据出现死锁</div><div class="line">ERROR 1213 (40001) at line 1: Deadlock found when trying to get lock; try restarting transaction</div><div class="line">#查看表中数据，发现有一条数据没有插入</div><div class="line">mysql&gt; select count(*) from t2;</div><div class="line">+----------+</div><div class="line">| count(*) |</div><div class="line">+----------+</div><div class="line">|     3009 |</div><div class="line">+----------+</div></pre></td></tr></table></figure>
<h4 id="3、宕机测试"><a href="#3、宕机测试" class="headerlink" title="3、宕机测试"></a>3、宕机测试</h4><p><strong>Tips：模拟出生产环境的样子，一边插入数据一边宕掉一个节点。</strong></p>
<h5 id="node1插入数据："><a href="#node1插入数据：" class="headerlink" title="node1插入数据："></a>node1插入数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./in.sh   //执行脚本，把量改为10000</div></pre></td></tr></table></figure>
<h5 id="node3查看是否在写入数据："><a href="#node3查看是否在写入数据：" class="headerlink" title="node3查看是否在写入数据："></a>node3查看是否在写入数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iotop</div></pre></td></tr></table></figure>
<h5 id="停掉node3上的percona实例："><a href="#停掉node3上的percona实例：" class="headerlink" title="停掉node3上的percona实例："></a>停掉node3上的percona实例：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@node3 ~]# /etc/init.d/mysql stop</div><div class="line">Shutting down MySQL (Percona XtraDB Cluster)...... SUCCESS!</div></pre></td></tr></table></figure>
<h5 id="查看日志："><a href="#查看日志：" class="headerlink" title="查看日志："></a>查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">160330 14:45:44 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: tcp://192.168.42.135:4567 tcp://192.168.42.136:4567 </div><div class="line">160330 14:45:45 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) reconnecting to 54e770a4 (tcp://192.168.42.135:4567), attempt 0</div><div class="line">160330 14:45:49 [Note] WSREP: (71ee066c, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</div><div class="line">160330 14:46:15 [Note] /usr/sbin/mysqld: Normal shutdown</div><div class="line"></div><div class="line">160330 14:46:15 [Note] WSREP: Stop replication</div><div class="line">160330 14:46:15 [Note] WSREP: Closing send monitor...</div><div class="line">160330 14:46:15 [Note] WSREP: Closed send monitor.</div><div class="line">160330 14:46:15 [Note] WSREP: gcomm: terminating thread</div><div class="line">160330 14:46:15 [Note] WSREP: gcomm: joining thread</div><div class="line">160330 14:46:15 [Note] WSREP: gcomm: closing backend</div><div class="line">160330 14:46:15 [Note] WSREP: view(view_id(NON_PRIM,54e770a4,13) memb &#123;</div><div class="line">        71ee066c,0</div><div class="line">&#125; joined &#123;</div><div class="line">&#125; left &#123;</div><div class="line">&#125; partitioned &#123;</div><div class="line">        54e770a4,0</div><div class="line">        8ed58cb5,0</div><div class="line">&#125;)</div><div class="line">160330 14:46:15 [Note] WSREP: New COMPONENT: primary = no, bootstrap = no, my_idx = 0, memb_num = 1</div><div class="line">160330 14:46:15 [Note] WSREP: view((empty))</div><div class="line">160330 14:46:15 [Note] WSREP: gcomm: closed</div><div class="line">160330 14:46:15 [Note] WSREP: Flow-control interval: [16, 16]</div><div class="line">160330 14:46:15 [Note] WSREP: Received NON-PRIMARY.</div><div class="line">160330 14:46:15 [Note] WSREP: Shifting SYNCED -&gt; OPEN (TO: 40708)</div><div class="line">160330 14:46:15 [Note] WSREP: Received self-leave message.</div><div class="line">160330 14:46:15 [Note] WSREP: Flow-control interval: [0, 0]</div><div class="line">160330 14:46:15 [Note] WSREP: Received SELF-LEAVE. Closing connection.</div><div class="line">160330 14:46:15 [Note] WSREP: Shifting OPEN -&gt; CLOSED (TO: 40708)</div><div class="line">160330 14:46:15 [Note] WSREP: RECV thread exiting 0: Success</div><div class="line">160330 14:46:15 [Note] WSREP: recv_thread() joined.</div><div class="line">160330 14:46:15 [Note] WSREP: Closing replication queue.</div><div class="line">160330 14:46:15 [Note] WSREP: Closing slave action queue.</div><div class="line">160330 14:46:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708, view# -1: non-Primary, number of nodes: 1, my index: 0, protocol version 3</div><div class="line">160330 14:46:15 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</div><div class="line">160330 14:46:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708, view# -1: non-Primary, number of nodes: 0, my index: -1, protocol version 3</div><div class="line">160330 14:46:15 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</div><div class="line">160330 14:46:15 [Note] WSREP: applier thread exiting (code:0)</div><div class="line">160330 14:46:15 [Note] WSREP: applier thread exiting (code:6)</div><div class="line">160330 14:46:17 [Note] WSREP: killing local connection: 5</div><div class="line">160330 14:46:17 [Note] WSREP: rollbacker thread exiting</div><div class="line">160330 14:46:17 [Note] Event Scheduler: Purging the queue. 0 events</div><div class="line">160330 14:46:17 [Note] WSREP: dtor state: CLOSED</div><div class="line">160330 14:46:17 [Note] WSREP: mon: entered 17693 oooe fraction 0 oool fraction 0</div><div class="line">160330 14:46:17 [Note] WSREP: mon: entered 17693 oooe fraction 0.153224 oool fraction 0</div><div class="line">160330 14:46:17 [Note] WSREP: mon: entered 18109 oooe fraction 0 oool fraction 5.52212e-05</div><div class="line">160330 14:46:17 [Note] WSREP: cert index usage at exit 0</div><div class="line">160330 14:46:17 [Note] WSREP: cert trx map usage at exit 92</div><div class="line">160330 14:46:17 [Note] WSREP: deps set usage at exit 0</div><div class="line">160330 14:46:17 [Note] WSREP: avg deps dist 101.239</div><div class="line">160330 14:46:17 [Note] WSREP: avg cert interval 0</div><div class="line">160330 14:46:17 [Note] WSREP: cert index size 94</div><div class="line">160330 14:46:17 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 14:46:17 [Note] WSREP: wsdb trx map usage 0 conn query map usage 0</div><div class="line">160330 14:46:17 [Note] WSREP: MemPool(LocalTrxHandle): hit ratio: 0, misses: 0, in use: 0, in pool: 0</div><div class="line">160330 14:46:17 [Note] WSREP: MemPool(SlaveTrxHandle): hit ratio: 0.992087, misses: 140, in use: 0, in pool: 140</div><div class="line">160330 14:46:17 [Note] WSREP: Shifting CLOSED -&gt; DESTROYED (TO: 40708)</div><div class="line">160330 14:46:17 [Note] WSREP: Flushing memory map to disk...</div><div class="line">160330 14:46:18  InnoDB: Starting shutdown...</div><div class="line">160330 14:46:22  InnoDB: Shutdown completed; log sequence number 19929651</div><div class="line">160330 14:46:22 [Note] /usr/sbin/mysqld: Shutdown complete</div><div class="line"></div><div class="line">160330 14:46:22 mysqld_safe mysqld from pid file /var/lib/mysql/node3.pid ended</div></pre></td></tr></table></figure>
<h5 id="重新启动node3实例，并查看日志："><a href="#重新启动node3实例，并查看日志：" class="headerlink" title="重新启动node3实例，并查看日志："></a>重新启动node3实例，并查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line">160330 15:02:13 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</div><div class="line">160330 15:02:13 mysqld_safe Skipping wsrep-recover for 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708 pair</div><div class="line">160330 15:02:13 mysqld_safe Assigning 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708 to wsrep_start_position</div><div class="line">160330 15:02:13 [Note] WSREP: wsrep_start_position var submitted: &apos;54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708&apos;</div><div class="line">160330 15:02:13 [Note] WSREP: Read nil XID from storage engines, skipping position init</div><div class="line">160330 15:02:13 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib64/libgalera_smm.so&apos;</div><div class="line">160330 15:02:14 [Note] WSREP: wsrep_load(): Galera 3.14(r53b88eb) by Codership Oy &lt;info@codership.com&gt; loaded successfully.</div><div class="line">160330 15:02:14 [Note] WSREP: CRC-32C: using hardware acceleration.</div><div class="line">160330 15:02:14 [Note] WSREP: Found saved state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</div><div class="line">160330 15:02:14 [Note] WSREP: Passing config to GCS: base_dir = /var/lib/mysql/; base_host = 192.168.42.137; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /var/lib/mysql/; gcache.keep_pages_count = 0; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /var/lib/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_quorum</div><div class="line">160330 15:02:14 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 15:02:14 [Note] WSREP: Assign initial position for certification: 40708, protocol version: -1</div><div class="line">160330 15:02:14 [Note] WSREP: wsrep_sst_grab()</div><div class="line">160330 15:02:14 [Note] WSREP: Start replication</div><div class="line">160330 15:02:14 [Note] WSREP: Setting initial position to 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</div><div class="line">160330 15:02:14 [Note] WSREP: protonet asio version 0</div><div class="line">160330 15:02:14 [Note] WSREP: Using CRC-32C for message checksums.</div><div class="line">160330 15:02:14 [Note] WSREP: backend: asio</div><div class="line">160330 15:02:14 [Warning] WSREP: access file(/var/lib/mysql//gvwstate.dat) failed(No such file or directory)</div><div class="line">160330 15:02:14 [Note] WSREP: restore pc from disk failed</div><div class="line">160330 15:02:14 [Note] WSREP: GMCast version 0</div><div class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567</div><div class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1</div><div class="line">160330 15:02:14 [Note] WSREP: EVS version 0</div><div class="line">160330 15:02:14 [Note] WSREP: gcomm: connecting to group &apos;Percona&apos;, peer &apos;192.168.42.135:,192.168.42.136:,192.168.42.137:&apos;</div><div class="line">160330 15:02:14 [Warning] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) address &apos;tcp://192.168.42.137:4567&apos; points to own listening address, blacklisting</div><div class="line">160330 15:02:14 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: </div><div class="line">160330 15:02:14 [Note] WSREP: declaring 54e770a4 at tcp://192.168.42.135:4567 stable</div><div class="line">160330 15:02:14 [Note] WSREP: declaring 8ed58cb5 at tcp://192.168.42.136:4567 stable</div><div class="line">160330 15:02:14 [Note] WSREP: Node 54e770a4 state prim</div><div class="line">160330 15:02:14 [Note] WSREP: view(view_id(PRIM,54e56db5,15) memb &#123;</div><div class="line">        54e56db5,0</div><div class="line">        54e770a4,0</div><div class="line">        8ed58cb5,0</div><div class="line">&#125; joined &#123;</div><div class="line">&#125; left &#123;</div><div class="line">&#125; partitioned &#123;</div><div class="line">&#125;)</div><div class="line">160330 15:02:14 [Note] WSREP: save pc into disk</div><div class="line">160330 15:02:15 [Note] WSREP: gcomm: connected</div><div class="line">160330 15:02:15 [Note] WSREP: Changing maximum packet size to 64500, resulting msg size: 32636</div><div class="line">160330 15:02:15 [Note] WSREP: Shifting CLOSED -&gt; OPEN (TO: 0)</div><div class="line">160330 15:02:15 [Note] WSREP: Opened channel &apos;Percona&apos;</div><div class="line">160330 15:02:15 [Note] WSREP: Waiting for SST to complete.</div><div class="line">160330 15:02:15 [Note] WSREP: New COMPONENT: primary = yes, bootstrap = no, my_idx = 0, memb_num = 3</div><div class="line">160330 15:02:15 [Note] WSREP: STATE_EXCHANGE: sent state UUID: 55870069-f645-11e5-baaa-5a660b7a7175</div><div class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: sent state msg: 55870069-f645-11e5-baaa-5a660b7a7175</div><div class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 0 (node3)</div><div class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 2 (node2)</div><div class="line">160330 15:02:15 [Note] WSREP: STATE EXCHANGE: got state msg: 55870069-f645-11e5-baaa-5a660b7a7175 from 1 (node1)</div><div class="line">160330 15:02:15 [Note] WSREP: Quorum results:</div><div class="line">        version    = 3,</div><div class="line">        component  = PRIMARY,</div><div class="line">        conf_id    = 9,</div><div class="line">        members    = 2/3 (joined/total),</div><div class="line">        act_id     = 53016,</div><div class="line">        last_appl. = -1,</div><div class="line">        protocols  = 0/7/3 (gcs/repl/appl),</div><div class="line">        group UUID = 54ebc9fd-f57f-11e5-baaa-96a1ced0928f</div><div class="line">160330 15:02:15 [Note] WSREP: Flow-control interval: [28, 28]</div><div class="line">160330 15:02:15 [Note] WSREP: Shifting OPEN -&gt; PRIMARY (TO: 53016)</div><div class="line">160330 15:02:15 [Note] WSREP: State transfer required: </div><div class="line">        Group state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</div><div class="line">        Local state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</div><div class="line">160330 15:02:15 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016, view# 10: Primary, number of nodes: 3, my index: 0, protocol version 3</div><div class="line">160330 15:02:15 [Warning] WSREP: Gap in state sequence. Need state transfer.</div><div class="line">160330 15:02:15 [Note] WSREP: Running: &apos;wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;28735&apos;&apos;</div><div class="line">WSREP_SST: [INFO] Streaming with xbstream (20160330 15:02:16.388)</div><div class="line">WSREP_SST: [INFO] Using socat as streamer (20160330 15:02:16.393)</div><div class="line">WSREP_SST: [INFO] Evaluating timeout -s9 100 socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:02:16.677)</div><div class="line">160330 15:02:16 [Note] WSREP: Prepared SST request: xtrabackup-v2|192.168.42.137:4444/xtrabackup_sst</div><div class="line">160330 15:02:16 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</div><div class="line">160330 15:02:16 [Note] WSREP: REPL Protocols: 7 (3, 2)</div><div class="line">160330 15:02:16 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 15:02:16 [Note] WSREP: Assign initial position for certification: 53016, protocol version: 3</div><div class="line">160330 15:02:16 [Note] WSREP: Service thread queue flushed.</div><div class="line">2016/03/30 15:02:16 socat[29014] E bind(3, &#123;AF=2 0.0.0.0:4444&#125;, 16): Address already in use</div><div class="line">160330 15:02:16 [Note] WSREP: Prepared IST receiver, listening at: tcp://192.168.42.137:4568</div><div class="line">160330 15:02:16 [Note] WSREP: Member 0.0 (node3) requested state transfer from &apos;*any*&apos;. Selected 2.0 (node2)(SYNCED) as donor.</div><div class="line">160330 15:02:16 [Note] WSREP: Shifting PRIMARY -&gt; JOINER (TO: 53016)</div><div class="line">160330 15:02:16 [Note] WSREP: Requesting state transfer: success, donor: 2</div><div class="line">WSREP_SST: [ERROR] Error while getting data from donor node:  exit codes: 1 0 (20160330 15:02:16.833)</div><div class="line">WSREP_SST: [ERROR] Cleanup after exit with status:32 (20160330 15:02:16.841)</div><div class="line">160330 15:02:16 [ERROR] WSREP: Process completed with error: wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;28735&apos;: 32 (Broken pipe)</div><div class="line">160330 15:02:16 [ERROR] WSREP: Failed to read uuid:seqno from joiner script.</div><div class="line">160330 15:02:16 [ERROR] WSREP: SST failed: 32 (Broken pipe)</div><div class="line">160330 15:02:16 [ERROR] Aborting</div><div class="line">160330 15:02:17 [Note] WSREP: 2.0 (node2): State transfer to 0.0 (node3) complete.</div><div class="line">160330 15:02:17 [Note] WSREP: Member 2.0 (node2) synced with group.</div><div class="line">xbstream: Can&apos;t create/write to file &apos;./xtrabackup_galera_info&apos; (Errcode: 2 - No such file or directory)</div><div class="line">xbstream: failed to create file.</div><div class="line">160330 15:02:17 [Note] WSREP: (54e56db5, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</div><div class="line">160330 15:02:18 [Note] WSREP: Closing send monitor...</div><div class="line">160330 15:02:18 [Note] WSREP: Closed send monitor.</div><div class="line">160330 15:02:18 [Note] WSREP: gcomm: terminating thread</div><div class="line">160330 15:02:18 [Note] WSREP: gcomm: joining thread</div><div class="line">160330 15:02:18 [Note] WSREP: gcomm: closing backend</div><div class="line">160330 15:02:18 [Note] WSREP: view(view_id(NON_PRIM,54e56db5,15) memb &#123;</div><div class="line">        54e56db5,0</div><div class="line">&#125; joined &#123;</div><div class="line">&#125; left &#123;</div><div class="line">&#125; partitioned &#123;</div><div class="line">        54e770a4,0</div><div class="line">        8ed58cb5,0</div><div class="line">&#125;)</div><div class="line">160330 15:02:18 [Note] WSREP: New COMPONENT: primary = no, bootstrap = no, my_idx = 0, memb_num = 1</div><div class="line">160330 15:02:18 [Note] WSREP: view((empty))</div><div class="line">160330 15:02:18 [Note] WSREP: gcomm: closed</div><div class="line">160330 15:02:18 [Note] WSREP: Flow-control interval: [16, 16]</div><div class="line">160330 15:02:18 [Note] WSREP: Received NON-PRIMARY.</div><div class="line">160330 15:02:18 [Note] WSREP: Shifting JOINER -&gt; OPEN (TO: 53016)</div><div class="line">160330 15:02:18 [Note] WSREP: Received self-leave message.</div><div class="line">160330 15:02:18 [Note] WSREP: Flow-control interval: [0, 0]</div><div class="line">160330 15:02:18 [Note] WSREP: Received SELF-LEAVE. Closing connection.</div><div class="line">160330 15:02:18 [Note] WSREP: Shifting OPEN -&gt; CLOSED (TO: 53016)</div><div class="line">160330 15:02:18 [Note] WSREP: RECV thread exiting 0: Success</div><div class="line">160330 15:02:18 [Note] WSREP: recv_thread() joined.</div><div class="line">160330 15:02:18 [Note] WSREP: Closing replication queue.</div><div class="line">160330 15:02:18 [Note] WSREP: Closing slave action queue.</div><div class="line">160330 15:02:18 [Note] WSREP: Service disconnected.</div><div class="line">160330 15:02:18 [Note] WSREP: rollbacker thread exiting</div><div class="line">160330 15:02:19 [Note] WSREP: Some threads may fail to exit.</div><div class="line">160330 15:02:19 [Note] /usr/sbin/mysqld: Shutdown complete</div><div class="line"></div><div class="line">Error in my_thread_global_end(): 1 threads didn&apos;t exit</div><div class="line">160330 15:02:25 mysqld_safe mysqld from pid file /var/lib/mysql/node3.pid ended</div></pre></td></tr></table></figure>
<h5 id="第一次启动失败，再次启动实例，并查看日志："><a href="#第一次启动失败，再次启动实例，并查看日志：" class="headerlink" title="第一次启动失败，再次启动实例，并查看日志："></a>第一次启动失败，再次启动实例，并查看日志：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div></pre></td><td class="code"><pre><div class="line">160330 15:02:58 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql</div><div class="line">160330 15:02:58 mysqld_safe WSREP: Running position recovery with --log_error=&apos;/var/lib/mysql/wsrep_recovery.PfWoiQ&apos; --pid-file=&apos;/var/lib/mysql/node3-recover.pid&apos;</div><div class="line">160330 15:03:01 mysqld_safe WSREP: Recovered position 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708</div><div class="line">160330 15:03:01 [Note] WSREP: wsrep_start_position var submitted: &apos;54ebc9fd-f57f-11e5-baaa-96a1ced0928f:40708&apos;</div><div class="line">160330 15:03:01 [Note] WSREP: Read nil XID from storage engines, skipping position init</div><div class="line">160330 15:03:01 [Note] WSREP: wsrep_load(): loading provider library &apos;/usr/lib64/libgalera_smm.so&apos;</div><div class="line">160330 15:03:01 [Note] WSREP: wsrep_load(): Galera 3.14(r53b88eb) by Codership Oy &lt;info@codership.com&gt; loaded successfully.</div><div class="line">160330 15:03:01 [Note] WSREP: CRC-32C: using hardware acceleration.</div><div class="line">160330 15:03:01 [Note] WSREP: Found saved state: 00000000-0000-0000-0000-000000000000:-1</div><div class="line">160330 15:03:01 [Note] WSREP: Passing config to GCS: base_dir = /var/lib/mysql/; base_host = 192.168.42.137; base_port = 4567; cert.log_conflicts = no; debug = no; evs.auto_evict = 0; evs.delay_margin = PT1S; evs.delayed_keep_period = PT30S; evs.inactive_check_period = PT0.5S; evs.inactive_timeout = PT15S; evs.join_retrans_period = PT1S; evs.max_install_timeouts = 3; evs.send_window = 4; evs.stats_report_period = PT1M; evs.suspect_timeout = PT5S; evs.user_send_window = 2; evs.view_forget_timeout = PT24H; gcache.dir = /var/lib/mysql/; gcache.keep_pages_count = 0; gcache.keep_pages_size = 0; gcache.mem_size = 0; gcache.name = /var/lib/mysql//galera.cache; gcache.page_size = 128M; gcache.size = 128M; gcs.fc_debug = 0; gcs.fc_factor = 1.0; gcs.fc_limit = 16; gcs.fc_master_slave = no; gcs.max_packet_size = 64500; gcs.max_throttle = 0.25; gcs.recv_q_hard_limit = 9223372036854775807; gcs.recv_q_soft_limit = 0.25; gcs.sync_donor = no; gmcast.segment = 0; gmcast.version = 0; pc.announce_timeout = PT3S; pc.checksum = false; pc.ignore_quorum</div><div class="line">160330 15:03:01 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 15:03:01 [Note] WSREP: Assign initial position for certification: -1, protocol version: -1</div><div class="line">160330 15:03:01 [Note] WSREP: wsrep_sst_grab()</div><div class="line">160330 15:03:01 [Note] WSREP: Start replication</div><div class="line">160330 15:03:01 [Note] WSREP: Setting initial position to 00000000-0000-0000-0000-000000000000:-1</div><div class="line">160330 15:03:01 [Note] WSREP: protonet asio version 0</div><div class="line">160330 15:03:01 [Note] WSREP: Using CRC-32C for message checksums.</div><div class="line">160330 15:03:01 [Note] WSREP: backend: asio</div><div class="line">160330 15:03:01 [Warning] WSREP: access file(/var/lib/mysql//gvwstate.dat) failed(No such file or directory)</div><div class="line">160330 15:03:01 [Note] WSREP: restore pc from disk failed</div><div class="line">160330 15:03:01 [Note] WSREP: GMCast version 0</div><div class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) listening at tcp://0.0.0.0:4567</div><div class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) multicast: , ttl: 1</div><div class="line">160330 15:03:01 [Note] WSREP: EVS version 0</div><div class="line">160330 15:03:01 [Note] WSREP: gcomm: connecting to group &apos;Percona&apos;, peer &apos;192.168.42.135:,192.168.42.136:,192.168.42.137:&apos;</div><div class="line">160330 15:03:01 [Warning] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) address &apos;tcp://192.168.42.137:4567&apos; points to own listening address, blacklisting</div><div class="line">160330 15:03:01 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting on, nonlive peers: </div><div class="line">160330 15:03:03 [Note] WSREP: declaring 54e770a4 at tcp://192.168.42.135:4567 stable</div><div class="line">160330 15:03:03 [Note] WSREP: declaring 8ed58cb5 at tcp://192.168.42.136:4567 stable</div><div class="line">160330 15:03:03 [Note] WSREP: Node 54e770a4 state prim</div><div class="line">160330 15:03:03 [Note] WSREP: view(view_id(PRIM,54e770a4,17) memb &#123;</div><div class="line">        54e770a4,0</div><div class="line">        711791c3,0</div><div class="line">        8ed58cb5,0</div><div class="line">&#125; joined &#123;</div><div class="line">&#125; left &#123;</div><div class="line">&#125; partitioned &#123;</div><div class="line">&#125;)</div><div class="line">160330 15:03:03 [Note] WSREP: save pc into disk</div><div class="line">160330 15:03:03 [Note] WSREP: gcomm: connected</div><div class="line">160330 15:03:03 [Note] WSREP: Changing maximum packet size to 64500, resulting msg size: 32636</div><div class="line">160330 15:03:03 [Note] WSREP: Shifting CLOSED -&gt; OPEN (TO: 0)</div><div class="line">160330 15:03:03 [Note] WSREP: Opened channel &apos;Percona&apos;</div><div class="line">160330 15:03:03 [Note] WSREP: Waiting for SST to complete.</div><div class="line">160330 15:03:03 [Note] WSREP: New COMPONENT: primary = yes, bootstrap = no, my_idx = 1, memb_num = 3</div><div class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: Waiting for state UUID.</div><div class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: sent state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82</div><div class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 2 (node2)</div><div class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 0 (node1)</div><div class="line">160330 15:03:03 [Note] WSREP: STATE EXCHANGE: got state msg: 72006bca-f645-11e5-ac84-eec46c5d6a82 from 1 (node3)</div><div class="line">160330 15:03:03 [Note] WSREP: Quorum results:</div><div class="line">        version    = 3,</div><div class="line">        component  = PRIMARY,</div><div class="line">        conf_id    = 11,</div><div class="line">        members    = 2/3 (joined/total),</div><div class="line">        act_id     = 53016,</div><div class="line">        last_appl. = -1,</div><div class="line">        protocols  = 0/7/3 (gcs/repl/appl),</div><div class="line">        group UUID = 54ebc9fd-f57f-11e5-baaa-96a1ced0928f</div><div class="line">160330 15:03:03 [Note] WSREP: Flow-control interval: [28, 28]</div><div class="line">160330 15:03:03 [Note] WSREP: Shifting OPEN -&gt; PRIMARY (TO: 53016)</div><div class="line">160330 15:03:03 [Note] WSREP: State transfer required: </div><div class="line">        Group state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</div><div class="line">        Local state: 00000000-0000-0000-0000-000000000000:-1</div><div class="line">160330 15:03:03 [Note] WSREP: New cluster view: global state: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016, view# 12: Primary, number of nodes: 3, my index: 1, protocol version 3</div><div class="line">160330 15:03:03 [Warning] WSREP: Gap in state sequence. Need state transfer.</div><div class="line">160330 15:03:03 [Note] WSREP: Running: &apos;wsrep_sst_xtrabackup-v2 --role &apos;joiner&apos; --address &apos;192.168.42.137&apos; --auth &apos;sst:123456&apos; --datadir &apos;/var/lib/mysql/&apos; --defaults-file &apos;/etc/my.cnf&apos; --parent &apos;29374&apos;&apos;</div><div class="line">WSREP_SST: [INFO] Streaming with xbstream (20160330 15:03:03.892)</div><div class="line">WSREP_SST: [INFO] Using socat as streamer (20160330 15:03:03.897)</div><div class="line">WSREP_SST: [INFO] Stale sst_in_progress file: /var/lib/mysql//sst_in_progress (20160330 15:03:03.907)</div><div class="line">WSREP_SST: [INFO] Evaluating timeout -s9 100 socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:03:03.985)</div><div class="line">160330 15:03:04 [Note] WSREP: Prepared SST request: xtrabackup-v2|192.168.42.137:4444/xtrabackup_sst</div><div class="line">160330 15:03:04 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</div><div class="line">160330 15:03:04 [Note] WSREP: REPL Protocols: 7 (3, 2)</div><div class="line">160330 15:03:04 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 15:03:04 [Note] WSREP: Assign initial position for certification: 53016, protocol version: 3</div><div class="line">160330 15:03:04 [Note] WSREP: Service thread queue flushed.</div><div class="line">160330 15:03:04 [Warning] WSREP: Failed to prepare for incremental state transfer: Local state UUID (00000000-0000-0000-0000-000000000000) does not match group state UUID (54ebc9fd-f57f-11e5-baaa-96a1ced0928f): 1 (Operation not permitted)</div><div class="line">         at galera/src/replicator_str.cpp:prepare_for_IST():489. IST will be unavailable.</div><div class="line">160330 15:03:04 [Note] WSREP: Member 1.0 (node3) requested state transfer from &apos;*any*&apos;. Selected 0.0 (node1)(SYNCED) as donor.</div><div class="line">160330 15:03:04 [Note] WSREP: Shifting PRIMARY -&gt; JOINER (TO: 53016)</div><div class="line">160330 15:03:04 [Note] WSREP: Requesting state transfer: success, donor: 0</div><div class="line">160330 15:03:05 [Note] WSREP: (711791c3, &apos;tcp://0.0.0.0:4567&apos;) turning message relay requesting off</div><div class="line">WSREP_SST: [INFO] Evaluating socat -u TCP-LISTEN:4444,reuseaddr stdio | xbstream -x; RC=( $&#123;PIPESTATUS[@]&#125; ) (20160330 15:03:05.519)</div><div class="line">WSREP_SST: [INFO] Proceeding with SST (20160330 15:03:05.538)</div><div class="line">WSREP_SST: [INFO] Cleaning the existing datadir and innodb-data/log directories (20160330 15:03:05.542)</div><div class="line">removed `/var/lib/mysql/test/db.opt&apos;</div><div class="line">removed directory: `/var/lib/mysql/test&apos;</div><div class="line">removed `/var/lib/mysql/mysql.sock&apos;</div><div class="line">removed `/var/lib/mysql/ibdata1&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/rwlock_instances.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/cond_instances.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/file_summary_by_instance.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/performance_timers.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_current.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/setup_timers.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/setup_consumers.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/file_instances.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/mutex_instances.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/threads.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_history_long.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/setup_instruments.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_history.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/db.opt&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_by_instance.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_by_thread_by_event_name.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/events_waits_summary_global_by_event_name.frm&apos;</div><div class="line">removed `/var/lib/mysql/performance_schema/file_summary_by_event_name.frm&apos;</div><div class="line">removed directory: `/var/lib/mysql/performance_schema&apos;</div><div class="line">removed `/var/lib/mysql/ib_logfile1&apos;</div><div class="line">removed `/var/lib/mysql/test_pxc/test_pxc.frm&apos;</div><div class="line">removed `/var/lib/mysql/test_pxc/db.opt&apos;</div><div class="line">removed `/var/lib/mysql/test_pxc/t2.frm&apos;</div><div class="line">removed directory: `/var/lib/mysql/test_pxc&apos;</div><div class="line">removed `/var/lib/mysql/xtrabackup_info&apos;</div><div class="line">removed `/var/lib/mysql/mysql/slow_log.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proxies_priv.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/func.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/servers.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/slow_log.CSM&apos;</div><div class="line">removed `/var/lib/mysql/mysql/user.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/db.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/columns_priv.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/tables_priv.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_topic.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_keyword.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_topic.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/columns_priv.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/plugin.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/event.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_category.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_keyword.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/slow_log.CSV&apos;</div><div class="line">removed `/var/lib/mysql/mysql/procs_priv.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/columns_priv.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/ndb_binlog_index.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_name.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_keyword.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proc.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_relation.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/procs_priv.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/func.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/event.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/event.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_name.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition_type.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/host.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/servers.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/user.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_relation.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_category.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/general_log.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/plugin.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_transition.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_name.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/host.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_relation.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proc.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/general_log.CSM&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/db.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone_leap_second.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/procs_priv.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/general_log.CSV&apos;</div><div class="line">removed `/var/lib/mysql/mysql/host.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/db.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/tables_priv.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proxies_priv.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proc.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/func.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_category.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/tables_priv.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/proxies_priv.frm&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/plugin.MYI&apos;</div><div class="line">removed `/var/lib/mysql/mysql/user.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/time_zone.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/help_topic.MYD&apos;</div><div class="line">removed `/var/lib/mysql/mysql/servers.frm&apos;</div><div class="line">removed directory: `/var/lib/mysql/mysql&apos;</div><div class="line">removed `/var/lib/mysql/ib_logfile0&apos;</div><div class="line">WSREP_SST: [INFO] Waiting for SST streaming to complete! (20160330 15:03:05.630)</div><div class="line">160330 15:03:18 [Note] WSREP: 0.0 (node1): State transfer to 1.0 (node3) complete.</div><div class="line">160330 15:03:18 [Note] WSREP: Member 0.0 (node1) synced with group.</div><div class="line">WSREP_SST: [INFO] Preparing the backup at /var/lib/mysql//.sst (20160330 15:03:19.498)</div><div class="line">WSREP_SST: [INFO] Evaluating innobackupex --no-version-check  --apply-log $rebuildcmd $&#123;DATA&#125; &amp;&gt;$&#123;DATA&#125;/innobackup.prepare.log (20160330 15:03:19.503)</div><div class="line">WSREP_SST: [INFO] Moving the backup to /var/lib/mysql/ (20160330 15:03:23.348)</div><div class="line">WSREP_SST: [INFO] Evaluating innobackupex --defaults-file=/etc/my.cnf --no-version-check   --move-back --force-non-empty-directories $&#123;DATA&#125; &amp;&gt;$&#123;DATA&#125;/innobackup.move.log (20160330 15:03:23.354)</div><div class="line">WSREP_SST: [INFO] Move successful, removing /var/lib/mysql//.sst (20160330 15:03:23.377)</div><div class="line">WSREP_SST: [INFO] Galera co-ords from recovery: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016 (20160330 15:03:23.416)</div><div class="line">WSREP_SST: [INFO] Total time on joiner: 0 seconds (20160330 15:03:23.423)</div><div class="line">WSREP_SST: [INFO] Removing the sst_in_progress file (20160330 15:03:23.430)</div><div class="line">160330 15:03:23 [Note] WSREP: SST complete, seqno: 53016</div><div class="line">160330 15:03:23 [Note] Plugin &apos;FEDERATED&apos; is disabled.</div><div class="line">160330 15:03:23 InnoDB: The InnoDB memory heap is disabled</div><div class="line">160330 15:03:23 InnoDB: Mutexes and rw_locks use GCC atomic builtins</div><div class="line">160330 15:03:23 InnoDB: Compressed tables use zlib 1.2.3</div><div class="line">160330 15:03:23 InnoDB: Using Linux native AIO</div><div class="line">160330 15:03:23 InnoDB: Initializing buffer pool, size = 128.0M</div><div class="line">160330 15:03:23 InnoDB: Completed initialization of buffer pool</div><div class="line">160330 15:03:23 InnoDB: highest supported file format is Barracuda.</div><div class="line">160330 15:03:23  InnoDB: Waiting for the background threads to start</div><div class="line">160330 15:03:24 Percona XtraDB (http://www.percona.com) 5.5.41-37.0 started; log sequence number 25433110</div><div class="line">160330 15:03:25 [Note] Event Scheduler: Loaded 0 events</div><div class="line">160330 15:03:25 [Note] WSREP: Signalling provider to continue.</div><div class="line">160330 15:03:25 [Note] WSREP: SST received: 54ebc9fd-f57f-11e5-baaa-96a1ced0928f:53016</div><div class="line">160330 15:03:25 [Note] /usr/sbin/mysqld: ready for connections.</div><div class="line">Version: &apos;5.5.41-37.0-55&apos;  socket: &apos;/var/lib/mysql/mysql.sock&apos;  port: 3306  Percona XtraDB Cluster (GPL), Release rel37.0, Revision 853, WSREP version 25.11, wsrep_25.11.r4027</div><div class="line">160330 15:03:25 [Note] WSREP: 1.0 (node3): State transfer from 0.0 (node1) complete.</div><div class="line">160330 15:03:25 [Note] WSREP: Shifting JOINER -&gt; JOINED (TO: 53016)</div><div class="line">160330 15:03:25 [Note] WSREP: Member 1.0 (node3) synced with group.</div><div class="line">160330 15:03:25 [Note] WSREP: Shifting JOINED -&gt; SYNCED (TO: 53016)</div><div class="line">160330 15:03:25 [Note] WSREP: Synchronized with group, ready for connections</div><div class="line">160330 15:03:25 [Note] WSREP: wsrep_notify_cmd is not defined, skipping notification.</div></pre></td></tr></table></figure>
<p><strong>使用sst进行同步后，成功加入集群，上面日志可以看出同步过程。</strong></p>
<h4 id="4、误删除测试"><a href="#4、误删除测试" class="headerlink" title="4、误删除测试"></a>4、误删除测试</h4><h5 id="删除node3上面的数据库文件："><a href="#删除node3上面的数据库文件：" class="headerlink" title="删除node3上面的数据库文件："></a>删除<code>node3</code>上面的数据库文件：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rm -rf /var/lib/mysql/test_pxc/</div><div class="line">#tips：生产环境删除东西别用-rf这个参数</div></pre></td></tr></table></figure>
<h5 id="查看数据库，已经没有了test-pxc这个数据库："><a href="#查看数据库，已经没有了test-pxc这个数据库：" class="headerlink" title="查看数据库，已经没有了test_pxc这个数据库："></a>查看数据库，已经没有了<code>test_pxc</code>这个数据库：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">mysql&gt; show databases;</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">| test               |</div><div class="line">+--------------------+</div></pre></td></tr></table></figure>
<h5 id="对node3上的数据库重启，SST恢复数据："><a href="#对node3上的数据库重启，SST恢复数据：" class="headerlink" title="对node3上的数据库重启，SST恢复数据："></a>对node3上的数据库重启，SST恢复数据：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[root@node3 mysql]# /etc/init.d/mysql restart</div><div class="line">Shutting down MySQL (Percona XtraDB Cluster) ERROR! MySQL (Percona XtraDB Cluster) server process #30193 is not running!</div><div class="line">Starting MySQL (Percona XtraDB Cluster).......State transfer in progress, setting sleep higher</div><div class="line">... SUCCESS!</div><div class="line"></div><div class="line">mysql&gt; show databases;</div><div class="line">+--------------------+</div><div class="line">| Database           |</div><div class="line">+--------------------+</div><div class="line">| information_schema |</div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">| test               |</div><div class="line">| test_pxc           |</div><div class="line">+--------------------+</div><div class="line">5 rows in set (0.00 sec)</div></pre></td></tr></table></figure>
<p><strong>数据恢复过程和宕机测试时的过程差不多。</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/04/08/HEXO+Github/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zaki">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xtez3.com1.z0.glb.clouddn.com/IMG_0450.JPG">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zaki">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/08/HEXO+Github/" itemprop="url">
                  HEXO+Github,搭建属于自己的博客
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-04-08T14:06:04+08:00">
                2016-04-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2016/04/08/HEXO+Github/" class="leancloud_visitors" data-flag-title="HEXO+Github,搭建属于自己的博客">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>注意</strong>：本教程只针对windows用户</p>
<h2 id="一、本地搭建hexo"><a href="#一、本地搭建hexo" class="headerlink" title="一、本地搭建hexo"></a>一、本地搭建hexo</h2><h3 id="1、安装GitBash"><a href="#1、安装GitBash" class="headerlink" title="1、安装GitBash"></a>1、安装GitBash</h3><p>官网下载，并安装</p>
<h3 id="2、安装Node-js"><a href="#2、安装Node-js" class="headerlink" title="2、安装Node.js"></a>2、安装Node.js</h3><p>官网下载：<a href="https://nodejs.org/en/" target="_blank" rel="external">https://nodejs.org/en/</a><br>安装时保持默认配置。</p>
<h3 id="3、安装hexo"><a href="#3、安装hexo" class="headerlink" title="3、安装hexo"></a>3、安装hexo</h3><p>在任意位置，右键打开GitBash，利用npm命令进行安装<br><code>npm install -g hexo</code></p>
<h3 id="4、创建hexo文件夹"><a href="#4、创建hexo文件夹" class="headerlink" title="4、创建hexo文件夹"></a>4、创建hexo文件夹</h3><p>安装完成后，在电脑中新建一个自己喜欢的文件夹（如I<code>:\hexo</code>）,然后在文件夹内右键选着GitBash，在GitBash工具下使用命令安装配置hexo。<br><code>hexo init</code><br>过程可能有点慢，需要下载一些东西，需要赖心等待。</p>
<h3 id="5、安装依赖包"><a href="#5、安装依赖包" class="headerlink" title="5、安装依赖包"></a>5、安装依赖包</h3><p><code>npm install</code></p>
<h3 id="6、本地查看"><a href="#6、本地查看" class="headerlink" title="6、本地查看"></a>6、本地查看</h3><p>在你的hexo目录下GitBash中执行以下命令，然后在浏览器打开localhost:4000查看，发现本地博客已经搭建成功。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#生成静态网页</div><div class="line">hexo generate</div><div class="line">#开启hexo服务</div><div class="line">hexo server</div></pre></td></tr></table></figure></p>
<h2 id="二、部署到Github上"><a href="#二、部署到Github上" class="headerlink" title="二、部署到Github上"></a>二、部署到Github上</h2><h3 id="1、注册Github账号"><a href="#1、注册Github账号" class="headerlink" title="1、注册Github账号"></a>1、注册Github账号</h3><p>在<a href="https://github.com/" target="_blank" rel="external">Github官网</a>进行注册，注册的新用户需要把本地的公钥放到Github上面去，具体过程可以参考<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000/001374385852170d9c7adf13c30429b9660d0eb689dd43a000" target="_blank" rel="external">这个blog</a>。</p>
<h3 id="2、创建repository"><a href="#2、创建repository" class="headerlink" title="2、创建repository"></a>2、创建repository</h3><p> 建立与你用户名对应的仓库，仓库名必须为<code>your_user_name.github.io</code>，固定写法，然后建立关联,我这里创建的名字：<code>zhou451971886.github.io</code><br> 编辑<code>_config.yml</code>(在<code>hexo</code>目录下)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">deploy:</div><div class="line">  type: github</div><div class="line">  repository: https://github.com/zhou451971886/zhou451971886.github.io.git</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<p>执行命令进行部署，以后重新部署都要用到下面3个步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hexo clean</div><div class="line">hexo generate</div><div class="line">hexo deploy</div></pre></td></tr></table></figure>
<p>如果出现错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR Deployer not found: github</div></pre></td></tr></table></figure></p>
<p>解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#在hexo文件夹下面</div><div class="line">npm install hexo-deployer-git --save</div><div class="line">#修改_config.yml,将type:github改为type：git</div><div class="line">vi _config.yml</div><div class="line"></div><div class="line">#_config.yml内容</div><div class="line">deploy:</div><div class="line">  type: git</div><div class="line">  repository: https://github.com/zhou451971886/zhou451971886.github.io.git</div><div class="line">  branch: master</div></pre></td></tr></table></figure>
<p>再部署：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">hexo clean</div><div class="line">hexo generate</div><div class="line">hexo deploy</div></pre></td></tr></table></figure></p>
<p>这样，我们自己的博客完全搭建了起来，在浏览器访问<code>http://zhou451971886.github.io</code>就可以看到属于自己的<code>blog</code>了！<br><strong>注意：</strong>每次修改本地文件后，需要<code>hexo generate</code>才能保存，而且必须在你的<code>hexo</code>目录下（我这里是<code>I:\hexo</code>）</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xtez3.com1.z0.glb.clouddn.com/IMG_0450.JPG"
               alt="Zaki" />
          <p class="site-author-name" itemprop="name">Zaki</p>
           
              <p class="site-description motion-element" itemprop="description">不忘初心，方得始终</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zaki</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("irdUYyX0kNduCKo3atibKalh-gzGzoHsz", "yI1UAMzULuJXfJxt5wuWjU0k");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


  
</body>
</html>
